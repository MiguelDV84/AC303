<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.Circle?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="org.mdv.view.controller.VentaInsertController"
            style="-fx-background-color: #F5F5F5;">

    <!-- TOP BAR -->
    <top>
        <HBox fx:id="topBar" alignment="CENTER_LEFT"
              style="-fx-background-color:#2C3E50; -fx-padding:10;">
            <Button text="â† Volver"
                    onAction="#handleBackButton"
                    style="-fx-background-radius:5; -fx-background-color:#BDC3C7;"/>
            <Label text="Registrar Nueva Venta"
                   style="-fx-text-fill:white; -fx-font-size:18px; -fx-font-weight:bold;"/>
            <Pane HBox.hgrow="ALWAYS"/>

            <HBox spacing="8">
                <Circle radius="6" fill="#2ECC71" onMouseClicked="#minimizarVentana"/>
                <Circle radius="6" fill="#F1C40F" onMouseClicked="#maximizarVentana"/>
                <Circle radius="6" fill="#E74C3C" onMouseClicked="#cerrarVentana"/>
            </HBox>
        </HBox>
    </top>

    <!-- CENTER -->
    <center>
        <GridPane hgap="20" vgap="20" style="-fx-padding:20;">
            <columnConstraints>
                <ColumnConstraints percentWidth="50"/>
                <ColumnConstraints percentWidth="50"/>
            </columnConstraints>

            <!-- IZQUIERDA: Info + cliente + resumen -->
            <VBox spacing="10" GridPane.columnIndex="0">

                <TitledPane text="ðŸ“„ InformaciÃ³n de la Venta" expanded="true">
                    <VBox spacing="10" style="-fx-padding:15;">
                        <Label text="Fecha de Venta:"/>
                        <DatePicker fx:id="fechaVentaPicker"/>
                    </VBox>
                </TitledPane>

                <TitledPane text="ðŸ§ Seleccionar Cliente" expanded="true">
                    <VBox spacing="10" style="-fx-padding:15;">
                        <Label text="DNI del Cliente:"/>
                        <HBox spacing="10">
                            <TextField fx:id="txtBuscarCliente" promptText="Buscar por DNI..."/>
                            <Button text="Buscar" onAction="#buscarCliente"/>
                        </HBox>

                        <VBox spacing="4" style="-fx-background-color:#ECF0F1; -fx-padding:10; -fx-background-radius:8;">
                            <Label fx:id="lblNombreCliente" text="Nombre:"/>
                            <Label fx:id="lblDniCliente" text="DNI:"/>
                            <Label fx:id="lblTelCliente" text="TelÃ©fono:"/>
                            <Label fx:id="lblDirCliente" text="DirecciÃ³n:"/>
                        </VBox>
                    </VBox>
                </TitledPane>

                <TitledPane text="ðŸ“Š Resumen de la Venta" expanded="true">
                    <VBox spacing="10" style="-fx-padding:15;">

                        <!-- TABLA CON PRODUCTOS AÃ‘ADIDOS -->
                        <TableView fx:id="tablaResumen" prefHeight="200">
                            <columns>
                                <TableColumn fx:id="colResProd" text="Producto" prefWidth="180"/>
                                <TableColumn fx:id="colResCant" text="Cant." prefWidth="60"/>
                                <TableColumn fx:id="colResPU" text="Precio" prefWidth="80"/>
                                <TableColumn fx:id="colResTotal" text="Total" prefWidth="90"/>
                            </columns>
                        </TableView>

                        <HBox spacing="10">
                            <Label text="Subtotal:"/>
                            <Label fx:id="lblSubtotal" text="0.00 â‚¬"/>
                        </HBox>

                        <HBox spacing="10">
                            <Label text="IVA (21%):"/>
                            <Label fx:id="lblIVA" text="0.00 â‚¬"/>
                        </HBox>

                        <HBox spacing="10">
                            <Label text="Descuento:"/>
                            <TextField fx:id="txtDescuento" promptText="0.00"/>
                        </HBox>

                        <Separator/>

                        <HBox spacing="10">
                            <Label text="TOTAL:" style="-fx-font-weight:bold; -fx-font-size:16;"/>
                            <Label fx:id="lblTotal" text="0.00 â‚¬" style="-fx-font-weight:bold; -fx-font-size:16;"/>
                        </HBox>

                    </VBox>
                </TitledPane>
            </VBox>

            <!-- DERECHA: Productos disponibles -->
            <VBox spacing="10" GridPane.columnIndex="1">
                <TitledPane text="ðŸ“¦ Productos" expanded="true">
                    <VBox spacing="10" style="-fx-padding:15;">

                        <HBox spacing="10">
                            <TextField fx:id="txtBuscarProducto" promptText="CÃ³digo o descripciÃ³n"/>
                            <Button text="Buscar" onAction="#buscarProducto"/>
                        </HBox>

                        <TableView fx:id="tablaProductos" prefHeight="350">
                            <columns>
                                <TableColumn fx:id="colProdNombre" text="Producto" prefWidth="180"/>
                                <TableColumn fx:id="colProdPrecio" text="Precio" prefWidth="80"/>
                                <TableColumn fx:id="colProdStock" text="Stock" prefWidth="70"/>
                                <TableColumn fx:id="colAccionAdd" text="AÃ±adir" prefWidth="80"/>
                                <TableColumn fx:id="colAccionRemove" text="Quitar" prefWidth="80"/>
                            </columns>

                        </TableView>

                    </VBox>
                </TitledPane>
            </VBox>
        </GridPane>
    </center>

    <!-- BOTONES -->
    <bottom>
        <HBox spacing="20" alignment="CENTER_RIGHT" style="-fx-padding: 10 20 20 20;">
            <Button text="Cancelar" onAction="#cancelarVenta" style="-fx-background-color:#7F8C8D; -fx-text-fill:white;"/>
            <Button text="Guardar Borrador" onAction="#guardarBorrador" style="-fx-background-color:#E67E22; -fx-text-fill:white;"/>
            <Button text="Finalizar" onAction="#finalizarVenta" style="-fx-background-color:#27AE60; -fx-text-fill:white;"/>
        </HBox>
    </bottom>

</BorderPane>
